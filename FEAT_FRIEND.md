# Friend Feature - TÃ­nh nÄƒng Báº¡n bÃ¨

## ğŸ“‹ Tá»•ng quan

TÃ­nh nÄƒng Friend cho phÃ©p ngÆ°á»i dÃ¹ng káº¿t ná»‘i vá»›i nhau, chia sáº» location notes yÃªu thÃ­ch, journeys vÃ  tráº£i nghiá»‡m du lá»‹ch. Táº¡o nÃªn má»™t cá»™ng Ä‘á»“ng chia sáº» vÃ  khÃ¡m phÃ¡ cÃ¡c Ä‘á»‹a Ä‘iá»ƒm thÃº vá»‹ táº¡i HÃ  Ná»™i.

## ğŸ¯ Má»¥c tiÃªu chÃ­nh

1. **Káº¿t ná»‘i xÃ£ há»™i**: Cho phÃ©p ngÆ°á»i dÃ¹ng káº¿t báº¡n vÃ  chia sáº» ná»™i dung vá»›i nhau
2. **Chia sáº» cÃ³ kiá»ƒm soÃ¡t**: NgÆ°á»i dÃ¹ng cÃ³ quyá»n kiá»ƒm soÃ¡t ai Ä‘Æ°á»£c xem ná»™i dung cá»§a há»
3. **KhÃ¡m phÃ¡**: TÃ¬m hiá»ƒu Ä‘á»‹a Ä‘iá»ƒm thÃ´ng qua kinh nghiá»‡m cá»§a báº¡n bÃ¨
4. **Cá»™ng Ä‘á»“ng**: XÃ¢y dá»±ng cá»™ng Ä‘á»“ng ngÆ°á»i dÃ¹ng gáº¯n káº¿t

---

## ğŸ‘¥ User Stories

### 1. Quáº£n lÃ½ Báº¡n bÃ¨ (Friend Management)

#### US-1.1: Gá»­i lá»i má»i káº¿t báº¡n

- **LÃ  ngÆ°á»i dÃ¹ng**, tÃ´i muá»‘n **tÃ¬m kiáº¿m ngÆ°á»i dÃ¹ng khÃ¡c** Ä‘á»ƒ **gá»­i lá»i má»i káº¿t báº¡n**
- **Acceptance Criteria**:
    - TÃ¬m kiáº¿m báº±ng email hoáº·c tÃªn
    - Hiá»ƒn thá»‹ avatar, tÃªn vÃ  sá»‘ lÆ°á»£ng location notes cá»§a ngÆ°á»i dÃ¹ng
    - CÃ³ thá»ƒ xem profile preview trÆ°á»›c khi gá»­i lá»i má»i
    - KhÃ´ng thá»ƒ gá»­i lá»i má»i náº¿u Ä‘Ã£ lÃ  báº¡n hoáº·c Ä‘Ã£ gá»­i lá»i má»i trÆ°á»›c Ä‘Ã³

#### US-1.2: Cháº¥p nháº­n/Tá»« chá»‘i lá»i má»i káº¿t báº¡n

- **LÃ  ngÆ°á»i dÃ¹ng**, tÃ´i muá»‘n **nháº­n thÃ´ng bÃ¡o vá» lá»i má»i káº¿t báº¡n** Ä‘á»ƒ **cháº¥p nháº­n hoáº·c tá»« chá»‘i**
- **Acceptance Criteria**:
    - Badge/counter hiá»ƒn thá»‹ sá»‘ lá»i má»i Ä‘ang chá»
    - Xem profile cá»§a ngÆ°á»i gá»­i lá»i má»i
    - Cháº¥p nháº­n hoáº·c tá»« chá»‘i lá»i má»i
    - Lá»i má»i bá»‹ tá»« chá»‘i cÃ³ thá»ƒ gá»­i láº¡i sau 30 ngÃ y

#### US-1.3: XÃ³a báº¡n bÃ¨

- **LÃ  ngÆ°á»i dÃ¹ng**, tÃ´i muá»‘n **xÃ³a báº¡n bÃ¨** khi **khÃ´ng cÃ²n muá»‘n káº¿t ná»‘i**
- **Acceptance Criteria**:
    - XÃ¡c nháº­n trÆ°á»›c khi xÃ³a
    - Sau khi xÃ³a, ná»™i dung Ä‘Ã£ chia sáº» khÃ´ng cÃ²n hiá»ƒn thá»‹ cho nhau
    - CÃ³ thá»ƒ káº¿t báº¡n láº¡i trong tÆ°Æ¡ng lai

#### US-1.4: Danh sÃ¡ch báº¡n bÃ¨

- **LÃ  ngÆ°á»i dÃ¹ng**, tÃ´i muá»‘n **xem danh sÃ¡ch báº¡n bÃ¨** Ä‘á»ƒ **quáº£n lÃ½ káº¿t ná»‘i**
- **Acceptance Criteria**:
    - Hiá»ƒn thá»‹ danh sÃ¡ch vá»›i avatar, tÃªn, sá»‘ location notes
    - TÃ¬m kiáº¿m trong danh sÃ¡ch báº¡n bÃ¨
    - Sáº¯p xáº¿p theo: tÃªn, ngÃ y káº¿t báº¡n, hoáº¡t Ä‘á»™ng gáº§n nháº¥t
    - Xem profile cá»§a báº¡n bÃ¨

### 2. Chia sáº» Ná»™i dung (Content Sharing)

#### US-2.1: Chia sáº» Location Notes vá»›i báº¡n bÃ¨

- **LÃ  ngÆ°á»i dÃ¹ng**, tÃ´i muá»‘n **chia sáº» location notes yÃªu thÃ­ch** vá»›i **báº¡n bÃ¨ cá»¥ thá»ƒ hoáº·c táº¥t cáº£ báº¡n bÃ¨**
- **Acceptance Criteria**:
    - Chá»n visibility cho má»—i location note: Private, Friends, Public
    - Chá»n chia sáº» vá»›i: All friends, hoáº·c Selected friends
    - Báº¡n bÃ¨ Ä‘Æ°á»£c chia sáº» cÃ³ thá»ƒ xem Ä‘áº§y Ä‘á»§ thÃ´ng tin (rating, notes, photos)
    - CÃ³ thá»ƒ thay Ä‘á»•i visibility báº¥t cá»© lÃºc nÃ o

#### US-2.2: Chia sáº» Journeys vá»›i báº¡n bÃ¨

- **LÃ  ngÆ°á»i dÃ¹ng**, tÃ´i muá»‘n **chia sáº» journey/hÃ nh trÃ¬nh** vá»›i **báº¡n bÃ¨**
- **Acceptance Criteria**:
    - Setting visibility cho Journey: Private, Friends, Public
    - Chá»n specific friends Ä‘á»ƒ chia sáº» journey
    - Journey Ä‘Æ°á»£c chia sáº» bao gá»“m táº¥t cáº£ stops vÃ  notes
    - Báº¡n bÃ¨ cÃ³ thá»ƒ duplicate journey Ä‘á»ƒ táº¡o journey riÃªng cá»§a há»

#### US-2.3: Chia sáº» Media vá»›i báº¡n bÃ¨

- **LÃ  ngÆ°á»i dÃ¹ng**, tÃ´i muá»‘n **chia sáº» áº£nh/video** vá»›i **báº¡n bÃ¨**
- **Acceptance Criteria**:
    - Media cÃ³ visibility setting: Private, Friends, Public
    - Báº¡n bÃ¨ cÃ³ thá»ƒ react trÃªn media
    - Media Ä‘Æ°á»£c chia sáº» hiá»ƒn thá»‹ trong profile vÃ  map

### 3. Xem Ná»™i dung cá»§a Báº¡n bÃ¨ (Friend Content Discovery)

#### US-3.1: Xem location notes cá»§a báº¡n bÃ¨

- **LÃ  ngÆ°á»i dÃ¹ng**, tÃ´i muá»‘n **xem location notes mÃ  báº¡n bÃ¨ Ä‘Ã£ share** Ä‘á»ƒ **khÃ¡m phÃ¡ nÆ¡i má»›i**
- **Acceptance Criteria**:
    - Map cÃ³ layer "Friends' Location Notes" cÃ³ thá»ƒ toggle on/off
    - Filter xem location note cá»§a: All friends, hoáº·c specific friend
    - Hiá»ƒn thá»‹ tÃªn báº¡n bÃ¨ Ä‘Ã£ share location note Ä‘Ã³
    - CÃ³ thá»ƒ thÃªm friend's location note vÃ o favorite cá»§a mÃ¬nh

#### US-3.2: Xem Journeys cá»§a báº¡n bÃ¨

- **LÃ  ngÆ°á»i dÃ¹ng**, tÃ´i muá»‘n **xem hÃ nh trÃ¬nh cá»§a báº¡n bÃ¨** Ä‘á»ƒ **láº¥y Ã½ tÆ°á»Ÿng cho chuyáº¿n Ä‘i**
- **Acceptance Criteria**:
    - Tab/section "Friends' Journeys"
    - Preview journey vá»›i map vÃ  stops
    - Duplicate journey Ä‘á»ƒ customize cho mÃ¬nh
    - CÃ³ thá»ƒ react trÃªn journey

---

## ğŸ—„ï¸ Database Schema

### 1. Friend Relationship Table

```prisma
enum FriendshipStatus {
  pending
  accepted
  blocked
}

model Friendship {
  id          String           @id @default(cuid())
  requesterId String           @map("requester_id")
  addresseeId String           @map("addressee_id")
  status      FriendshipStatus @default(pending)
  createdAt   DateTime         @default(now()) @map("created_at")
  updatedAt   DateTime         @updatedAt @map("updated_at")

  // Relations
  requester User @relation("FriendshipRequester", fields: [requesterId], references: [id], onDelete: Cascade)
  addressee User @relation("FriendshipAddressee", fields: [addresseeId], references: [id], onDelete: Cascade)

  @@unique([requesterId, addresseeId])
  @@index([requesterId, status])
  @@index([addresseeId, status])
  @@map("friendships")
}
```

### 2. Friend Content Sharing

```prisma
enum ShareVisibility {
  private
  friends
  selected_friends
  public
}

model FriendShare {
  id         String          @id @default(cuid())
  userId     String          @map("user_id")
  contentId  String          @map("content_id") // location_note_id, journey_id, media_id
  contentType String         @map("content_type") // 'location_note', 'journey', 'media'
  visibility ShareVisibility @default(private)
  sharedWith String[]        @map("shared_with") // array of user IDs for selected_friends
  createdAt  DateTime        @default(now()) @map("created_at")

  // Relations
  user User @relation("UserShares", fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, contentId, contentType])
  @@index([userId, contentType])
  @@index([contentId, contentType])
  @@map("friend_shares")
}
```

### 3. Social Interactions

```prisma
enum ReactionType {
  love
  like
  wow
  smile
  fire
}

model Reaction {
  id          String       @id @default(cuid())
  userId      String       @map("user_id")
  contentId   String       @map("content_id")
  contentType String       @map("content_type")
  type        ReactionType
  createdAt   DateTime     @default(now()) @map("created_at")

  // Relations
  user User @relation("UserReactions", fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, contentId, contentType])
  @@index([contentId, contentType])
  @@map("reactions")
}

```

### 4. Recommendations

```prisma
enum RecommendationStatus {
  pending
  accepted
  dismissed
}

model Recommendation {
  id              String               @id @default(cuid())
  fromUserId      String               @map("from_user_id")
  toUserId        String               @map("to_user_id")
  locationNoteId  String               @map("location_note_id")
  message         String?              @db.Text
  status          RecommendationStatus @default(pending)
  createdAt       DateTime             @default(now()) @map("created_at")

  // Relations
  fromUser     User         @relation("SentRecommendations", fields: [fromUserId], references: [id], onDelete: Cascade)
  toUser       User         @relation("ReceivedRecommendations", fields: [toUserId], references: [id], onDelete: Cascade)
  locationNote LocationNote @relation(fields: [locationNoteId], references: [id], onDelete: Cascade)

  @@index([toUserId, status])
  @@index([fromUserId])
  @@map("recommendations")
}
```

---

## ğŸ”Œ API Endpoints

### Friend Management

```typescript
// Friend requests
POST   /api/friends/request          // Gá»­i lá»i má»i káº¿t báº¡n
GET    /api/friends/requests          // Láº¥y danh sÃ¡ch lá»i má»i
POST   /api/friends/accept/:id        // Cháº¥p nháº­n lá»i má»i
POST   /api/friends/reject/:id        // Tá»« chá»‘i lá»i má»i
DELETE /api/friends/:id               // XÃ³a báº¡n bÃ¨

// Friend list
GET    /api/friends                   // Láº¥y danh sÃ¡ch báº¡n bÃ¨
GET    /api/friends/search            // TÃ¬m kiáº¿m ngÆ°á»i dÃ¹ng
GET    /api/friends/:id/profile       // Xem profile báº¡n bÃ¨
```

### Content Sharing

```typescript
// Share settings
POST   /api/share/location-note/:id   // Set visibility cho location note
POST   /api/share/journey/:id         // Set visibility cho journey
POST   /api/share/media/:id           // Set visibility cho media
GET    /api/share/settings            // Láº¥y default share settings

// View shared content
GET    /api/friends/location-notes    // Láº¥y location notes cá»§a báº¡n bÃ¨
GET    /api/friends/journeys          // Láº¥y journeys cá»§a báº¡n bÃ¨
GET    /api/friends/:id/content       // Láº¥y ná»™i dung cá»§a 1 báº¡n cá»¥ thá»ƒ
```

---

## ğŸ¨ UI/UX Components

### 1. Friends Page (`/friends`)

**Layout:**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ” Search Friends     [+ Add Friend]â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ“¬ Friend Requests (3)              â”‚
â”‚   - User A wants to connect         â”‚
â”‚   - User B wants to connect         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ‘¥ My Friends (24)                  â”‚
â”‚   [All] [Recent] [Active]           â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚   â”‚ Avatar   â”‚ Avatar   â”‚ Avatar  â”‚â”‚
â”‚   â”‚ User C   â”‚ User D   â”‚ User E  â”‚â”‚
â”‚   â”‚ 45 notes â”‚ 28 notes â”‚ 67 notesâ”‚â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Features:**

- Tab switching: All Friends, Requests, Suggestions
- Friend search vá»›i autocomplete
- Badge notification cho requests
- Grid/List view toggle

### 2. Friends Map Layer

**Features:**

- Toggle "Show Friends' Location Notes" trÃªn map
- Filter by specific friend
- Different marker color cho friend's location notes
- Popup hiá»ƒn thá»‹: "Shared by [Friend Name]"
- Action: "Add to My Favorites"

### 3. Feed Page (`/feed`)

**Layout:**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Friends Activity Feed               â”‚
â”‚ [All] [Notes] [Journeys] [Photos]  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ“ User A added "Cafe X"           â”‚
â”‚    2 hours ago                      â”‚
â”‚    [Map Preview]                    â”‚
â”‚    â¤ï¸ 5  ğŸ‘ 3  ğŸ”¥ 2                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ—ºï¸ User B created "Weekend Trip"   â”‚
â”‚    5 hours ago                      â”‚
â”‚    [Journey Preview]                â”‚
â”‚    â¤ï¸ 12  ğŸ˜Š 8                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4. Share Settings Dialog

**Features:**

- Quick visibility toggle: ğŸ”’ Private | ğŸ‘¥ Friends | ğŸŒ Public
- "Share with specific friends" option
- Friend selector vá»›i search
- Default sharing preference setting

### 5. Recommendation Dialog

**Features:**

- "Recommend to Friend" button trÃªn location note detail
- Friend selector (multi-select)
- Optional message field
- Preview of location note Ä‘Æ°á»£c recommend

---

## ğŸ” Privacy & Security

### Privacy Controls

1. **Default Visibility Settings**
    - User cÃ³ thá»ƒ set default visibility cho: Location Notes, Journeys, Media
    - Options: Private (default), Friends, Public

2. **Granular Sharing**
    - Má»—i content item cÃ³ thá»ƒ override default setting
    - Selected friends sharing cho sensitive content

3. **Friend List Privacy**
    - Option áº©n friend list khá»i ngÆ°á»i khÃ¡c
    - Chá»‰ mutual friends má»›i tháº¥y friend list

4. **Block Feature**
    - Block user Ä‘á»ƒ prevent friend request
    - Blocked users khÃ´ng tháº¥y public content

### Security Measures

1. **Rate Limiting**
    - Limit friend requests: 10/day
    - Limit recommendations: 20/day
    - Comment/reaction rate limits

2. **Spam Prevention**
    - Cannot resend rejected friend request trong 30 ngÃ y
    - Auto-block sau 5 rejected requests liÃªn tiáº¿p

3. **Content Moderation**
    - Report inappropriate comments/recommendations
    - Admin review system

---

## ğŸ“± Implementation Plan

### Phase 1: Core Friend System (Week 1-2)

- [ ] Database migrations cho Friendship table
- [ ] Friend request API endpoints
- [ ] Friends list page UI
- [ ] Friend search functionality
- [ ] Accept/Reject/Remove friend actions

### Phase 2: Content Sharing (Week 3-4)

- [ ] Visibility settings cho Location Notes
- [ ] Visibility settings cho Journeys
- [ ] Friend content API endpoints
- [ ] Friends' Location Notes map layer
- [ ] Friend share settings UI

### Phase 3: Social Features (Week 5-6)

- [ ] Reaction system
- [ ] Activity feed
- [ ] Friend profile page
- [ ] Notifications for interactions

### Phase 4: Advanced Features (Week 7-8)

- [ ] Recommendation system
- [ ] Feed filtering & sorting
- [ ] Privacy settings page
- [ ] Block/Report features
- [ ] Journey duplicate from friends

---

## ğŸš€ Nice-to-Have Features

### 1. Friend Suggestions (Smart Recommendations)

- Gá»£i Ã½ káº¿t báº¡n dá»±a trÃªn:
    - Mutual friends
    - Similar taste (location notes favorited)
    - Same areas visited
    - Common journeys

### 2. Collaborative Features

- **Collaborative Journeys**: Multiple friends cÃ¹ng edit 1 journey
- **Group Trips**: Extension cá»§a Group feature vá»›i friends
- **Shared Albums**: Táº¡o album áº£nh chung vá»›i friends

### 3. Gamification

- **Badges**: "Explorer" (visited 50 locations), "Social Butterfly" (20 friends)
- **Leaderboards**: Most active explorers among friends
- **Challenges**: "Visit 10 new cafes this month" vá»›i friends

### 4. Enhanced Discovery

- **Similar Taste**: "Friends with similar taste"
- **Explore Together**: Location notes mÃ  báº¡n vÃ  friend chÆ°a ai Ä‘i
- **Friend Heatmap**: Visualize areas friends thÆ°á»ng Ä‘i

### 5. Social Proof

- "10 of your friends have been here"
- "5 friends shared this location"
- Rating aggregation tá»« friends

### 6. Chat/Messaging (Optional)

- Direct messaging vá»›i friends
- Share location notes/journeys qua chat
- Group chats cho planning trips

### 7. Stories Feature

- 24-hour temporary posts
- Share quick updates vá» location notes
- View friends' stories on map

### 8. Travel Plans Sharing

- Share planned future trips
- Friends cÃ³ thá»ƒ join hoáº·c suggest location notes
- Calendar integration

### 9. Friend Collections

- Curate themed collections vÃ  share vá»›i friends
- "Best Coffee Spots in Hanoi" collection
- Collaborative collections

### 10. Privacy Zones

- Set "khÃ´ng hiá»ƒn thá»‹" zones (home, work)
- Blur exact locations náº¿u cáº§n
- Time-based visibility (chia sáº» sau khi vá»)

---

## âš ï¸ Considerations & Edge Cases

### 1. Performance

- Paginate friend lists (50 per page)
- Lazy load activity feed
- Cache friend relationships
- Index optimization cho queries

### 2. Scale

- Consider NoSQL cho activity feed náº¿u scale lá»›n
- CDN cho friend avatars
- Background jobs cho notifications

### 3. User Experience

- Empty states: "No friends yet", "No activity"
- Loading states cho all async operations
- Error handling: Network errors, permission denied
- Offline support: Cache friend list

### 4. Data Migration

- Existing content default to Private
- Migration script cáº­p nháº­t visibility
- Notify users vá» new privacy settings

### 5. Legal/GDPR

- User consent cho data sharing
- Right to delete: Remove all friend data
- Export friend data option
- Clear privacy policy

---

## ğŸ“Š Success Metrics

### User Engagement

- % users cÃ³ Ã­t nháº¥t 1 friend
- Average friends per user
- Daily/Weekly active friend interactions
- Friend content views vs own content

### Social Virality

- Friend requests sent/accepted rate
- Content share rate
- Comments & reactions per post
- Recommendations sent/accepted

### Retention

- Return rate sau khi add friends
- Friend-driven discovery (clicks on friend content)
- Time spent on feed vs map

---

## ğŸ¯ Conclusion

Feature Friend sáº½ transform Hanoi Plan App tá»« má»™t personal planning tool thÃ nh má»™t **social discovery platform**. NgÆ°á»i dÃ¹ng khÃ´ng chá»‰ plan cho riÃªng mÃ¬nh mÃ  cÃ²n há»c há»i vÃ  khÃ¡m phÃ¡ qua tráº£i nghiá»‡m cá»§a báº¡n bÃ¨, táº¡o nÃªn má»™t community gáº¯n káº¿t vÃ  há»¯u Ã­ch.

**Key Differentiators:**

- Privacy-first: Granular control over sharing
- Context-aware: Chia sáº» trong context of location notes & journeys
- Discovery-focused: Easier to find good locations qua trusted friends
- Community-building: Not just social, but helpful & practical
- Simple interactions: Focus on reactions, khÃ´ng cÃ³ comment complexity
